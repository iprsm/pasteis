<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pedidos de Pastéis</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #fafafa; padding: 20px; text-align: center; }
    .container { max-width: 500px; margin: auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);}
    input, button { margin: 8px 0; padding: 10px; width: 100%; border-radius: 8px; border: 1px solid #ccc; }
    button { background: #28a745; color: white; font-weight: bold; cursor: pointer; }
    button:hover { background: #218838; }
    #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); }
    #modal-content { background: #fff; margin: 10% auto; padding: 20px; width: 90%; max-width: 500px; border-radius: 10px; text-align: center; }
  </style>
</head>
<body>
  <div class="container">
    <img src="iprsmlogo.jpg" alt="Logo" width="120">
    <h2>Monte seu Pedido de Pastéis</h2>
    <input type="text" id="nome" placeholder="Seu nome">

    <label>Sabores (separe por vírgula e quantidade ex: carne=2, queijo=3)</label>
    <input type="text" id="sabores" placeholder="Digite os sabores e quantidades">

    <button onclick="gerarPedido()">Gerar Pedido</button>
  </div>

  <!-- Modal -->
  <div id="modal">
    <div id="modal-content">
      <h3>Resumo do Pedido</h3>
      <p id="resumo"></p>
      <canvas id="qrcode"></canvas>
      <p><strong>Pix Copia e Cola:</strong></p>
      <textarea id="pixCode" rows="4" style="width:100%;"></textarea>
      <br><br>
      <button onclick="fecharModal()">Fechar</button>
    </div>
  </div>

<script>
const chavePix = "11979654420"; // sua chave Pix
const scriptURL = "COLE_AQUI_A_URL_DO_SEU_WEBAPP"; // URL do Apps Script

function gerarPedido() {
  const nome = document.getElementById("nome").value.trim();
  const saboresInput = document.getElementById("sabores").value.trim();

  if (!nome || !saboresInput) {
    alert("Preencha seu nome e os sabores.");
    return;
  }

  let totalPastel = 0;
  let listaSabores = [];

  saboresInput.split(",").forEach(item => {
    const [sabor, qtd] = item.split("=");
    const quantidade = parseInt(qtd) || 1;
    listaSabores.push(`${sabor.trim()} (${quantidade})`);
    totalPastel += quantidade;
  });

  // cálculo do preço
  let valorTotal = 0;
  if (totalPastel >= 5) {
    const combos = Math.floor(totalPastel / 5);
    const resto = totalPastel % 5;
    valorTotal = combos * 50 + resto * 12;
  } else {
    valorTotal = totalPastel * 12;
  }

  // gera hash
  const hash = Math.random().toString(36).substring(2, 10).toUpperCase();

  // monta código Pix simples
  const pixCopiaCola = `00020126360014BR.GOV.BCB.PIX0114${chavePix}520400005303986540${valorTotal.toFixed(2)}5802BR5913Pastelaria6009SaoPaulo62070503***6304ABCD`;

  // exibir modal
  document.getElementById("resumo").innerText = 
    `Nome: ${nome}\nSabores: ${listaSabores.join(", ")}\nQtd: ${totalPastel}\nValor: R$ ${valorTotal.toFixed(2)}\nCódigo: ${hash}`;

  document.getElementById("pixCode").value = pixCopiaCola;

  QRCode.toCanvas(document.getElementById("qrcode"), pixCopiaCola, function (error) {
    if (error) console.error(error);
  });

  document.getElementById("modal").style.display = "block";

  // envia para planilha
  enviarParaPlanilha(nome, hash, listaSabores.join(", "), totalPastel, valorTotal, pixCopiaCola);
}

function fecharModal() {
  document.getElementById("modal").style.display = "none";
}

function enviarParaPlanilha(nome, hash, sabores, totalPastel, valor, pixCopiaCola) {
  const data = {
    nome: nome,
    hash: hash,
    sabores: sabores,
    totalPastel: totalPastel,
    valor: valor,
    pix: pixCopiaCola
  };

  fetch(scriptURL, {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  }).then(() => {
    console.log("✅ Pedido enviado para planilha");
  }).catch(err => {
    console.error("❌ Erro ao enviar:", err);
  });
}
</script>
</body>
</html>

